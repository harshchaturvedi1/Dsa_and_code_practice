<!DOCTYPE html>
<html lang="en">

<head>
    <title>Socket IO</title>
</head>
<style>
    body {
        background-color: rgb(7, 6, 6);
        margin: 0;
        padding-bottom: 3rem;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
            Helvetica, Arial, sans-serif;
    }

    .mainWrapper {
        width: 500px;
        margin: auto;
        height: 95vh;
        background-color: grey;
        border: 1px solid;
        overflow: scroll;
    }

    #form {
        background: rgba(0, 0, 0, 0.15);
        padding: 0.25rem;
        bottom: 0;
        left: 0;
        right: 0;
        display: flex;
        height: 3rem;
        box-sizing: border-box;
        backdrop-filter: blur(10px);
    }

    #input {
        border: none;
        padding: 0 1rem;
        flex-grow: 1;
        border-radius: 2rem;
        margin: 0.25rem;
    }

    #input:focus {
        outline: none;
    }

    #form>button {
        background: #333;
        border: none;
        padding: 0 1rem;
        margin: 0.25rem;
        border-radius: 3px;
        outline: none;
        color: #fff;
    }

    #messages {
        margin: 0;
        padding: 0;
        height: 94%;
    }

    .leftSide {
        padding: 10px;
        max-width: 80%;
        display: inline-block;
    }

    .rightSide {
        margin-left: 20%;
        padding: 10px;
        display: grid;
        align-items: right;
        width: fit-content;
    }

    .rightWrapper {
        display: flex;
        justify-content: flex-end;
    }

    .personName {
        font-weight: 550;
        color: rgb(193 12 56);
        margin-bottom: 1px;
    }

    .messageText {
        background-color: white;
        border-radius: 10px;
        padding: 5px 10px;
    }
</style>

<body>
    <div class="mainWrapper">
        <div id="messages">

        </div>
        <div class="formWrapper">
            <form id="form">
                <input type="text" id="input">
                <button>send</button>
            </form>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();

        let pName = "";

        if (!pName) {
            pName = prompt("enter your name");
        }

        var form = document.getElementById("form");
        var input = document.getElementById("input");
        var message = document.getElementById("messages");

        form.addEventListener("submit", (e) => {
            e.preventDefault();
            if (input.value) {
                socket.emit("chat message", {
                    userName: pName,
                    msgContent: input.value,
                });
                input.value = "";
            }
        });

        socket.on("chat message", (msg) => {
            let item = document.createElement("div");
            let msgContainer = document.createElement("div");
            let usrName = document.createElement("div");
            let msgContent = document.createElement("div");

            msgContent.innerText = msg.msgContent;
            msgContent.setAttribute("class", "messageText");

            usrName.innerText = msg.userName;
            usrName.setAttribute("class", "personName");

            let lastMsg = document.getElementsByClassName("personName");

            if (pName === msg.userName) {
                msgContainer.setAttribute("class", "rightSide");
                msgContainer.append(msgContent);
                item.setAttribute("class", "rightWrapper");
            } else if (
                lastMsg[lastMsg.length - 1] &&
                lastMsg[lastMsg.length - 1].innerText === msg.userName
            ) {
                msgContainer.setAttribute("class", "leftSide");
                msgContainer.append(msgContent);
            } else {
                msgContainer.setAttribute("class", "leftSide");
                msgContainer.append(usrName, msgContent);
            }
            item.append(msgContainer);
            message.appendChild(item);
            window.scrollTo(0, document.body.scrollHeight);
        });
    </script>
</body>

</html>